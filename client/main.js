var e=require("fs"),t=require("electron");var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r=t,o={};Object.defineProperty(o,"__esModule",{value:!0});var a=void 0;o.UpdatePreview=a;var i,d={};i=d,Object.defineProperty(i,"__esModule",{value:!0});var s;var u="undefined"==typeof document?void 0:document,c=!!u&&"content"in u.createElement("template"),l=!!u&&u.createRange&&"createContextualFragment"in u.createRange();function f(e){return e=e.trim(),c?function(e){var t=u.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(e):l?function(e){return s||(s=u.createRange()).selectNode(u.body),s.createContextualFragment(e).childNodes[0]}(e):function(e){var t=u.createElement("body");return t.innerHTML=e,t.childNodes[0]}(e)}function p(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function m(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var h={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}m(e,t,"selected")},INPUT:function(e,t){m(e,t,"checked"),m(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}};function v(){}function y(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var g,b=(g=function(e,t){var n,r,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var d=i.length-1;d>=0;d--)r=(n=i[d]).name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==a&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,a))):e.getAttribute(r)!==a&&e.setAttribute(r,a);for(var s=e.attributes,u=s.length-1;u>=0;u--)r=(n=s[u]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName){var r=t;(t=u.createElement("html")).innerHTML=r}else t=f(t);var o=n.getNodeKey||y,a=n.onBeforeNodeAdded||v,i=n.onNodeAdded||v,d=n.onBeforeElUpdated||v,s=n.onElUpdated||v,c=n.onBeforeNodeDiscarded||v,l=n.onNodeDiscarded||v,m=n.onBeforeElChildrenUpdated||v,b=!0===n.childrenOnly,x=Object.create(null),M=[];function w(e){M.push(e)}function T(e,t,n){!1!==c(e)&&(t&&t.removeChild(e),l(e),function e(t,n){if(1===t.nodeType)for(var r=t.firstChild;r;){var a=void 0;n&&(a=o(r))?w(a):(l(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function C(e){i(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=o(t);if(r){var a=x[r];a&&p(t,a)&&(t.parentNode.replaceChild(a,t),N(a,t))}C(t),t=n}}function N(e,t,n){var r=o(t);if(r&&delete x[r],!n){if(!1===d(e,t))return;if(g(e,t),s(e),!1===m(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,i,d,s,c=t.firstChild,l=e.firstChild;e:for(;c;){for(d=c.nextSibling,n=o(c);l;){if(i=l.nextSibling,c.isSameNode&&c.isSameNode(l)){c=d,l=i;continue e}r=o(l);var f=l.nodeType,m=void 0;if(f===c.nodeType&&(1===f?(n?n!==r&&((s=x[n])?i===s?m=!1:(e.insertBefore(s,l),r?w(r):T(l,e,!0),l=s):m=!1):r&&(m=!1),(m=!1!==m&&p(l,c))&&N(l,c)):3!==f&&8!=f||(m=!0,l.nodeValue!==c.nodeValue&&(l.nodeValue=c.nodeValue))),m){c=d,l=i;continue e}r?w(r):T(l,e,!0),l=i}if(n&&(s=x[n])&&p(s,c))e.appendChild(s),N(s,c);else{var v=a(c);!1!==v&&(v&&(c=v),c.actualize&&(c=c.actualize(e.ownerDocument||u)),e.appendChild(c),C(c))}c=d,l=i}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=o(t))?w(n):T(t,e,!0),t=r}}(e,l,r);var y=h[e.nodeName];y&&y(e,t)}(e,t):h.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var r=o(n);r&&(x[r]=n),e(n),n=n.nextSibling}}(e);var S,E,A=e,R=A.nodeType,H=t.nodeType;if(!b)if(1===R)1===H?p(e,t)||(l(e),A=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(e,(S=t.nodeName,(E=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==E?u.createElementNS(E,S):u.createElement(S)))):A=t;else if(3===R||8===R){if(H===R)return A.nodeValue!==t.nodeValue&&(A.nodeValue=t.nodeValue),A;A=t}if(A===t)l(e);else{if(t.isSameNode&&t.isSameNode(A))return;if(N(A,t,b),M)for(var L=0,q=M.length;L<q;L++){var P=x[M[L]];P&&T(P,P.parentNode,!1)}}return!b&&A!==e&&e.parentNode&&(A.actualize&&(A=A.actualize(e.ownerDocument||u)),e.parentNode.replaceChild(A,e)),A});d.default=b;var x,M=(x=d)&&x.__esModule?x:{default:x};a=class{constructor(e,t){this.dom=e,this.mjController=t}async update(e,t){for(const t of Array.from(e.querySelectorAll("span.math"))){const e=t.firstElementChild;e&&"SCRIPT"===e.nodeName&&(t.isSameNode=function(t){if("SPAN"!==t.nodeName)return!1;const n=t;if(!n.classList.contains("math"))return!1;const r=n.querySelector("script");return!!r&&(e.innerHTML===r.innerHTML&&e.type===r.type)})}if((0,M.default)(this.dom,e,{childrenOnly:!0,onBeforeElUpdated:function(e,t){return!e.isEqualNode(t)},getNodeKey:function(e){return e.id&&e.closest&&null!==e.closest("svg")?"":e.id}}),t)return this.mjController.queueTypeset(this.dom)}},o.UpdatePreview=a;var w={};Object.defineProperty(w,"__esModule",{value:!0});var T=function(e){const t=document.getElementById("MathJax_SVG_Hidden"),n=t&&t.parentElement;return null!==n?n.outerHTML+e.innerHTML:e.innerHTML};w.processHTMLString=T;var C=void 0;w.MathJaxController=C;class N{constructor(e,t){this.userMacros=e,this.mathJaxConfig=t,this.readyPromise=this.attachMathJax()}static async create(e,t){const n=new N(e,t);return await n.readyPromise,n}dispose(){const e=document.head.querySelector(`script[src='${N.mjSrc}']`);e&&e.remove()}jaxTeXConfig(){return{extensions:this.mathJaxConfig.texExtensions,Macros:this.userMacros,equationNumbers:this.mathJaxConfig.numberEquations?{autoNumber:"AMS",useLabelIds:!1}:{}}}async queueTypeset(e){if(Array.from(document.querySelectorAll('script[type^="math/tex"]')).some(e=>!e.id))return new Promise(t=>{MathJax.InputJax.TeX&&(MathJax.Hub.Queue(["resetEquationNumbers",MathJax.InputJax.TeX]),this.mathJaxConfig.numberEquations&&(MathJax.Hub.Queue(["PreProcess",MathJax.Hub]),MathJax.Hub.Queue(["Reprocess",MathJax.Hub]))),MathJax.Hub.Queue(["Typeset",MathJax.Hub,e]),MathJax.Hub.Queue([t])})}async attachMathJax(){await async function(e){const t=document.createElement("script");return t.src=e,t.type="text/javascript",document.head.appendChild(t),new Promise(e=>{t.addEventListener("load",()=>e())})}(N.mjSrc),MathJax.Hub.Config({jax:["input/TeX","output/"+this.mathJaxConfig.latexRenderer],extensions:[],TeX:this.jaxTeXConfig(),"HTML-CSS":{availableFonts:[],webFont:"TeX",imageFont:null,undefinedFamily:this.mathJaxConfig.undefinedFamily,mtextFontInherit:!0},messageStyle:"none",showMathMenu:!1,skipStartupTypeset:!0}),MathJax.Hub.Configured()}}C=N,w.MathJaxController=C,N.mjSrc=n.require.resolve("mathjax")+"?delayStartupUntil=configured";var S={};Object.defineProperty(S,"__esModule",{value:!0});var E=function(e){if(!e)return;e.catch(e=>{console.error(e)})};S.handlePromise=E;var A=function(e){return!!(0,H.existsSync)(e)&&(0,H.lstatSync)(e).isFile()};S.isFileSync=A;var R=function(e,t){let n=e;for(const e of t){const t=n.querySelectorAll(":scope > "+e.tag).item(e.index);if(!t)break;n=t}return n===e?void 0:n};S.resolveElement=R;var H=e;var L=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=J();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(S),q={};Object.defineProperty(q,"__esModule",{value:!0});var P=function(e){return e.querySelectorAll("img[src],audio[src],video[src],link[href]")};function J(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return J=function(){return e},e}q.getMedia=P,window.addEventListener("error",e=>{const t=e.error;r.ipcRenderer.sendToHost("uncaught-error",{message:t.message,name:t.name,stack:t.stack})}),window.addEventListener("unhandledrejection",e=>{const t=e.reason;r.ipcRenderer.sendToHost("uncaught-error",{message:t.message,name:t.name,stack:t.stack})});const O={mathJax:function(){let e;const t=new Promise(t=>e=t);return t.resolve=e,t}(),sourceLineMap:new Map,revSourceMap:new WeakMap};let j;r.ipcRenderer.on("init",(e,t)=>{O.mathJax.resolve(w.MathJaxController.create(t.userMacros,t.mathJaxConfig)),document.documentElement.dataset.markdownPreviewPlusContext=t.context,"pdf-export"===t.context&&document.documentElement.style.setProperty("width",t.pdfExportOptions.width+"mm","important")}),r.ipcRenderer.on("set-source-map",(e,{map:t})=>{const n=document.querySelector("div.update-preview");if(!n)throw new Error("No root element!");const r=new Map,o=new WeakMap;for(const[e,a]of Object.entries(t)){const t=parseInt(e,10),i=L.resolveElement(n,a);if(i){r.set(t,i);const e=o.get(i);e?e.push(t):o.set(i,[t])}}O.sourceLineMap=r,O.revSourceMap=o}),r.ipcRenderer.on("scroll-sync",(e,{firstLine:t,lastLine:n})=>{const r=Math.floor(.5*(t+n)),o=O.sourceLineMap;let a,i;for(a=r;a>=0&&(i=o.get(a),!i);a-=1);if(!i)return;const d=Math.max(...Array.from(o.keys()));let s,u;for(s=r+1;s<d&&(u=o.get(s),!u);s+=1);if(!u)return;const c=i.getBoundingClientRect().top,l=u.getBoundingClientRect().top,f=(r-t)/(n-t),p=document.documentElement.scrollTop-document.documentElement.clientHeight/2+c+f*(l-c);window.scroll({top:p})}),r.ipcRenderer.on("style",(e,{styles:t})=>{let n=document.head.querySelector("style#atom-styles");n||(n=document.createElement("style"),n.id="atom-styles",document.head.appendChild(n)),n.innerHTML=t.join("\n")}),r.ipcRenderer.on("update-images",(e,{oldsrc:t,v:n})=>{const r=(0,q.getMedia)(document);for(const e of Array.from(r)){let r,o,a;a="LINK"===e.tagName?"href":"src";let i=e.getAttribute(a);const d=i.match(/^(.*)\?v=(\d+)$/);d&&([,i,r]=d),i===t&&(void 0!==r&&(o=parseInt(r,10)),n!==o&&(e[a]=n?`${i}?v=${n}`:""+i))}}),r.ipcRenderer.on("sync",(e,{line:t,flash:n})=>{if(!document.querySelector("div.update-preview"))return;let r=O.sourceLineMap.get(t);if(!r)for(let e=t-1;e>=0&&(r=O.sourceLineMap.get(t),!r);e-=1);r&&(r.scrollIntoViewIfNeeded(!0),n&&(r.classList.add("flash"),setTimeout(()=>r.classList.remove("flash"),1e3)))}),r.ipcRenderer.on("update-preview",async(e,{id:t,html:n,renderLaTeX:a})=>{const i=document.querySelector("div.update-preview");if(!i)return;j||(j=new o.UpdatePreview(i,await O.mathJax));const d=(new DOMParser).parseFromString(n,"text/html"),s=document;if(s&&d.head.hasChildNodes){let e=s.head.querySelector("original-elements");e||(e=s.createElement("original-elements"),s.head.appendChild(e)),e.innerHTML="";for(const t of Array.from(d.head.childNodes))e.appendChild(t)}await j.update(d.body,a),r.ipcRenderer.sendToHost("request-reply",{id:t,request:"update-preview",result:(0,w.processHTMLString)(i)})}),r.ipcRenderer.on("await-fully-ready",async(e,{id:t})=>{"complete"!==document.readyState?document.addEventListener("load",(function e(){r.ipcRenderer.sendToHost("request-reply",{id:t,request:"await-fully-ready",result:void 0}),document.removeEventListener("load",e)})):r.ipcRenderer.sendToHost("request-reply",{id:t,request:"await-fully-ready",result:void 0})});const I=document.createElement("base");let U;document.head.appendChild(I),r.ipcRenderer.on("set-base-path",(e,{path:t})=>{I.href=t||""}),r.ipcRenderer.on("error",(e,{msg:t})=>{const n=document.querySelector("div.update-preview");if(!n)return;const r=document.createElement("div");r.innerHTML=`<h2>Previewing Markdown Failed</h2><h3>${t}</h3>`,n.appendChild(r)}),document.addEventListener("wheel",e=>{e.ctrlKey&&(e.deltaY>0?r.ipcRenderer.sendToHost("zoom-in",void 0):e.deltaY<0&&r.ipcRenderer.sendToHost("zoom-out",void 0),e.preventDefault(),e.stopPropagation())}),document.addEventListener("scroll",e=>{const t=document.documentElement.clientHeight,n=Array.from(O.sourceLineMap.entries()).filter(([e,n])=>{const{top:r,bottom:o}=n.getBoundingClientRect();return r>0&&o<t}).map(([e,t])=>e);r.ipcRenderer.sendToHost("did-scroll-preview",{max:Math.max(...n),min:Math.min(...n)})}),document.addEventListener("contextmenu",e=>{U=e.target,r.ipcRenderer.sendToHost("show-context-menu",void 0)}),r.ipcRenderer.on("sync-source",(e,{id:t})=>{let n=U;const o=O.revSourceMap;let a=o.get(n);for(;!a&&n.parentElement;)n=n.parentElement,a=o.get(n);a&&r.ipcRenderer.sendToHost("request-reply",{id:t,request:"sync-source",result:Math.min(...a)})}),r.ipcRenderer.on("reload",(e,{id:t})=>{window.onbeforeunload=null,r.ipcRenderer.sendToHost("request-reply",{id:t,request:"reload",result:void 0})}),window.onbeforeunload=function(){return!1},r.ipcRenderer.on("get-tex-config",async(e,{id:t})=>{r.ipcRenderer.sendToHost("request-reply",{id:t,request:"get-tex-config",result:(await O.mathJax).jaxTeXConfig()})}),r.ipcRenderer.on("get-selection",async(e,{id:t})=>{const n=window.getSelection(),o=n&&n.toString(),a=n&&n.anchorNode;r.ipcRenderer.sendToHost("request-reply",{id:t,request:"get-selection",result:o&&a?o:void 0})}),document.addEventListener("click",e=>{if(!e.target)return;const t=e.target;if("A"===t.tagName){const n=t.getAttribute("href");if(n&&n.startsWith("#")){e.preventDefault();const t=document.getElementById(decodeURIComponent(n).slice(1));t&&t.scrollIntoView()}}});
//# sourceMappingURL=main.js.map
